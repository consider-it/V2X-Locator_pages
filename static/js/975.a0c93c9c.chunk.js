(()=>{"use strict";var e={5975:(e,t,s)=>{var r=s(3703);let o=function(e){return e.INIT="init",e.LATEST_MESSAGE="latest-message",e.UPDATE_SETTINGS="update-settings",e}({}),n=function(e){return e.OBU_INFO="on-obu-info",e.GEOJSON="on-geojson",e.ERROR="error",e.CONNECTED="on-connect",e.GLOSA="glosa",e.RAW_MSG="raw-message",e.MATCHED_LANE_PHASES="matched-lane-phases",e.LOOPBACK="loopback",e}({});let a=function(e){return e[e.GREEN_LANES=0]="GREEN_LANES",e[e.RED_LANES=1]="RED_LANES",e[e.YELLOW_LANES=2]="YELLOW_LANES",e[e.DARK_LANES=3]="DARK_LANES",e[e.INTERSECTION_REFPT=4]="INTERSECTION_REFPT",e[e.STATIC_LANES=5]="STATIC_LANES",e[e.DENM=6]="DENM",e[e.CAM=7]="CAM",e[e.CPM=8]="CPM",e[e.GLOSA_DEBUG=9]="GLOSA_DEBUG",e[e.TL_CONTROL=10]="TL_CONTROL",e[e.MAP_GLOSA=11]="MAP_GLOSA",e[e.OBU_PATH=12]="OBU_PATH",e[e.IVIM=13]="IVIM",e[e.IOT_CLOUD_DATA=14]="IOT_CLOUD_DATA",e[e.OBU_POS=15]="OBU_POS",e}({});var i=s(5909);let E=function(e){return e.SPATEM="v2x/rx/spatem",e.OBU_INFO="v2x/rx/obuinfo",e.MAPEM="v2x/rx/mapem",e.DENM="v2x/rx/denm",e.CAM="v2x/rx/cam",e.CPM="v2x/rx/cpm",e.IVIM="v2x/rx/ivim",e.SREM="v2x/rx/srem",e.SSEM="v2x/rx/ssem",e.SPATEM_REDUCED="v2x/rx-red/spatem",e.MAPEM_REDUCED="v2x/rx-red/mapem",e.DENM_REDUCED="v2x/rx-red/denm",e.CAM_REDUCED="v2x/rx-red/cam",e.CPM_REDUCED="v2x/rx-red/cpm",e.IVIM_REDUCED="v2x/rx-red/ivim",e.SREM_REDUCED="v2x/rx-red/srem",e.SSEM_REDUCED="v2x/rx-red/ssem",e.DENM_LOOPBACK="v2x/loopback/denm",e.CPM_LOOPBACK="v2x/loopback/cpm",e}({});class d{constructor(e,t,s,r,o){this._brokerUri=void 0,this._usesRxRed=void 0,this._client=void 0,this.onObuInfo=void 0,this.onError=void 0,this.onMessage=void 0,this.disconnect=()=>{this._client.end()},this._onConnect=e=>()=>{null===e||void 0===e||e.call(this),this._client.subscribe([E.OBU_INFO,...this._usesRxRed?[E.SPATEM_REDUCED,E.MAPEM_REDUCED,E.DENM_REDUCED,E.CAM_REDUCED,E.CPM_REDUCED,E.IVIM_REDUCED,E.SREM_REDUCED,E.SSEM_REDUCED]:[E.SPATEM,E.MAPEM,E.DENM,E.CAM,E.CPM,E.IVIM,E.SSEM,E.SREM],E.DENM_LOOPBACK,E.CPM_LOOPBACK])},this._brokerUri=e,this._usesRxRed=t,this.onError=o,this.onMessage=s,this._client=(0,i.connect)(this._brokerUri),this._client.on("connect",this._onConnect(r)),this._client.on("message",this.onMessage),null!=this.onError&&this._client.on("error",this.onError)}}let l,c,v,M,u,_=!1;const p=async()=>{_||(await(0,r.Ay)(),_=!0),l=new r.gc(function(e){return new r.vU(e.spatemMaxFreqMs,e.usesV2xRxWrapper,e.laneCorridorWidthM,e.featureLifetimeMs,e.camMaxFreqMs,e.approachHeadingTolerance,e.usingMatchedLanes,!1,e.userFriendlyGlosa,e.debugGlosa,!1,e.showObuPathHistory,e.showConsoleDebug)}(v),((e,t)=>postMessage({type:n.GEOJSON,src:e,json:t})),((e,t,s,r)=>{postMessage({type:n.OBU_INFO,obuInfo:{lat:t,lon:e,heading:s,kphSpeed:r,time:Date.now()}})}),((e,t)=>{(e===r.F5.MqttDenmLoopbackMsg||e===r.F5.MqttCpmLoopbackMsg)&&t.length>0&&postMessage({type:n.LOOPBACK,src:e===r.F5.MqttDenmLoopbackMsg?a.DENM:a.CPM,json:t})}),((e,t,s,r)=>{postMessage({type:n.MATCHED_LANE_PHASES,greenLaneUuids:e,yellowLaneUuids:t,redLaneUuids:s,darkLaneUuids:r})})),clearInterval(M),clearInterval(u),M=setInterval((()=>{var e;return null===(e=l)||void 0===e?void 0:e.prune()}),v.featureLifetimeMs),u=setInterval((()=>{var e;const t=null===(e=l)||void 0===e?void 0:e.glosa(),s=[];for(let r=0;r<t.length;r+=4){const e=t[r+2],o=t[r+3];s.push({phase:t[r],direction:t[r+1],remainingSec:e<=0?void 0:e,advisedSpeedKph:o<=0?void 0:o})}postMessage({type:n.GLOSA,glosa:s})}),v.glosaFrequencyMs),(()=>{var e;null===(e=c)||void 0===e||e.disconnect(),c=new d(v.brokerUrl,v.usesRateReducedTopics,((e,t)=>{var s;return null===(s=l)||void 0===s?void 0:s.push_mqtt_message(t,e)}),(e=>postMessage({type:n.CONNECTED,error:e})),(e=>postMessage({type:n.ERROR,error:e})))})()};onmessage=e=>{var t,s,r,a,i,E;switch(null===(t=e.data)||void 0===t?void 0:t.type){case o.INIT:if(null==(null===(s=e.data)||void 0===s?void 0:s.settings))return void postMessage({type:n.ERROR,error:`Worker must be instantiated with a valid settings object. Found data: ${JSON.stringify(e.data)}`});v=e.data.settings,p();break;case o.UPDATE_SETTINGS:if(null==(null===(r=e.data)||void 0===r?void 0:r.settings))return void postMessage({type:n.ERROR,error:`Worker must be instantiated with a valid settings object. Found data: ${JSON.stringify(e.data)}`});v=e.data.settings,p();break;case o.LATEST_MESSAGE:if(null==(null===(a=e.data)||void 0===a?void 0:a.stationId)||null==(null===(i=e.data)||void 0===i?void 0:i.messageType))return void postMessage({type:n.ERROR,error:`A valid station ID as well as a message type is needed. Found: ${JSON.stringify(e.data)}`});const t=null===(E=l)||void 0===E?void 0:E.get_latest_message(e.data.messageType,e.data.stationId,e.data.secondaryId);postMessage({type:n.RAW_MSG,rawMsg:t})}}}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}s.m=e,s.x=()=>{var e=s.O(void 0,[891],(()=>s(5975)));return e=s.O(e)},(()=>{var e=[];s.O=(t,r,o,n)=>{if(!r){var a=1/0;for(l=0;l<e.length;l++){r=e[l][0],o=e[l][1],n=e[l][2];for(var i=!0,E=0;E<r.length;E++)(!1&n||a>=n)&&Object.keys(s.O).every((e=>s.O[e](r[E])))?r.splice(E--,1):(i=!1,n<a&&(a=n));if(i){e.splice(l--,1);var d=o();void 0!==d&&(t=d)}}return t}n=n||0;for(var l=e.length;l>0&&e[l-1][2]>n;l--)e[l]=e[l-1];e[l]=[r,o,n]}})(),s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,r)=>(s.f[r](e,t),t)),[])),s.u=e=>"static/js/"+e+".acc3cda4.chunk.js",s.miniCssF=e=>{},s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.p="/",(()=>{s.b=self.location+"/../../../";var e={975:1};s.f.i=(t,r)=>{e[t]||importScripts(s.p+s.u(t))};var t=self.webpackChunkv2x_locator_web_app=self.webpackChunkv2x_locator_web_app||[],r=t.push.bind(t);t.push=t=>{var o=t[0],n=t[1],a=t[2];for(var i in n)s.o(n,i)&&(s.m[i]=n[i]);for(a&&a(s);o.length;)e[o.pop()]=1;r(t)}})(),(()=>{var e=s.x;s.x=()=>s.e(891).then(e)})();s.x()})();
//# sourceMappingURL=975.a0c93c9c.chunk.js.map